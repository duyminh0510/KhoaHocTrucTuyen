<!DOCTYPE html>
<html
  lang="vi"
  th:replace="~{/views/gdienChung/templateChung.html::view(~{::main}, ~{::title})}"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Globaledu Login</title>
  </head>

  <body>
    <main class="login">
      <section>
        <div
          class="container-fluid"
          style="margin-top: 65px; margin-bottom: 65px"
        >
          <div
            class="row d-flex justify-content-center align-items-center h-100"
          >
            <!-- C·ªôt h√¨nh ·∫£nh -->
            <div
              class="col-md-6 d-flex justify-content-center align-items-center"
            >
              <img
                th:src="@{/photos/logodangnhap.png}"
                class="img-fluid custom-img"
                alt="H·ªçc t·∫≠p online"
              />
            </div>

            <!-- Form ƒëƒÉng nh·∫≠p -->
            <div class="col-md-6">
              <div style="width: 100%; max-width: 450px">
                <h2 class="text-center mb-4">
                  üîë ƒêƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c h·ªçc t·∫≠p n√†o b·∫°n
                </h2>

                <form
                  action="/auth/login/form"
                  method="post"
                  novalidate
                  id="loginForm"
                >
                  <div class="mb-0">
                    <label class="form-label">Email</label>
                    <input
                      type="email"
                      name="email"
                      class="form-control"
                      placeholder="Nh·∫≠p email"
                      autocomplete="username"
                      required
                      pattern="^[a-zA-Z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$"
                      title="Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ email h·ª£p l·ªá"
                      th:value="${email}"
                    />
                    <div
                      class="form-text text-danger"
                      id="email-error"
                      style="display: none"
                    ></div>
                  </div>

                  <div class="mb-4 mt-2">
                    <label class="form-label">M·∫≠t kh·∫©u</label>
                    <input
                      type="password"
                      name="password"
                      class="form-control"
                      placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
                      autocomplete="current-password"
                      required
                      minlength="6"
                      title="M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±"
                    />
                    <!-- ‚úÖ L·ªói t·ª´ server -->
                    <div
                      class="form-text text-danger"
                      id="password-error-server"
                      th:if="${passwordError != null}"
                      th:text="${passwordError}"
                    ></div>
                    <!-- ‚úÖ L·ªói t·ª´ client -->
                    <div
                      class="form-text text-danger"
                      id="password-error-client"
                      style="display: none"
                    ></div>
                  </div>

                  <div class="text-center">
                    <button class="btn btn-primary w-100" type="submit">
                      ƒêƒÉng nh·∫≠p
                    </button>
                  </div>

                  <div class="text-center mt-3">
                    <div class="d-flex align-items-center text-center my-3">
                      <hr class="flex-grow-1 me-2" />
                      <p class="mb-0">T√πy ch·ªçn ƒëƒÉng nh·∫≠p kh√°c:</p>
                      <hr class="flex-grow-1 ms-2" />
                    </div>

                    <div class="d-flex justify-content-center">
                      <a
                        href="#"
                        class="btn-google"
                        data-bs-toggle="tooltip"
                        data-bs-placement="top"
                        title="ƒêƒÉng nh·∫≠p b·∫±ng Google"
                      >
                        <img
                          th:src="@{/photos/google.png}"
                          alt="ƒêƒÉng nh·∫≠p v·ªõi Google"
                        />
                      </a>
                    </div>
                  </div>

                  <div class="text-center mt-3">
                    Kh√¥ng c√≥ t√†i kho·∫£n?
                    <a style="text-decoration: none" th:href="@{/auth/dangky}"
                      >ƒêƒÉng k√Ω</a
                    >
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ‚úÖ Modal th√¥ng b√°o logout -->
      <div
        class="modal fade"
        id="alertModal"
        tabindex="-1"
        aria-labelledby="alertModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content border-0 shadow-lg rounded-3">
            <div class="modal-header bg-primary text-white">
              <h5 class="modal-title" id="alertModalLabel">
                <i class="bi bi-exclamation-circle-fill me-2"></i>Th√¥ng b√°o
              </h5>
              <button
                type="button"
                class="btn-close btn-close-white"
                data-bs-dismiss="modal"
                aria-label="ƒê√≥ng"
              ></button>
            </div>
            <div class="modal-body fs-5 text-dark" id="modal-message"></div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline-primary"
                data-bs-dismiss="modal"
              >
                ƒê√≥ng
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚úÖ Bootstrap Bundle -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

      <!-- ‚úÖ JS: x·ª≠ l√Ω l·ªói nh·∫≠p -->
      <script>
        document
          .getElementById("loginForm")
          .addEventListener("submit", function (e) {
            const emailInput = document.querySelector('input[name="email"]');
            const passwordInput = document.querySelector(
              'input[name="password"]'
            );
            const emailError = document.getElementById("email-error");
            const passwordErrorClient = document.getElementById(
              "password-error-client"
            );
            const passwordErrorServer = document.getElementById(
              "password-error-server"
            );

            let hasError = false;

            // Reset l·ªói
            emailError.style.display = "none";
            emailError.textContent = "";
            passwordErrorClient.style.display = "none";
            passwordErrorClient.textContent = "";

            if (passwordErrorServer) {
              passwordErrorServer.style.display = "none";
            }

            // Ki·ªÉm tra email
            if (!emailInput.value.trim()) {
              emailError.textContent = "Vui l√≤ng nh·∫≠p email.";
              emailError.style.display = "block";
              hasError = true;
            } else if (!emailInput.checkValidity()) {
              emailError.textContent = "Email kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng.";
              emailError.style.display = "block";
              hasError = true;
            }

            // Ki·ªÉm tra m·∫≠t kh·∫©u
            if (!passwordInput.value.trim()) {
              passwordErrorClient.textContent = "Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u.";
              passwordErrorClient.style.display = "block";
              hasError = true;
            }

            if (hasError) {
              e.preventDefault(); // Ch·∫∑n submit n·∫øu c√≥ l·ªói ph√≠a client
            }
          });
      </script>

      <!-- ‚úÖ JS: Hi·ªÉn th·ªã modal khi logout -->
      <script th:inline="javascript">
        /*<![CDATA[*/
        let logout = /*[[${param.logout}]]*/ false;

        if (logout) {
          const modalEl = document.getElementById("alertModal");
          document.getElementById("modal-message").textContent =
            "ƒêƒÉng xu·∫•t th√†nh c√¥ng.";
          const modal = new bootstrap.Modal(modalEl);
          modal.show();
        }
        /*]]>*/
      </script>
    </main>
  </body>
</html>
