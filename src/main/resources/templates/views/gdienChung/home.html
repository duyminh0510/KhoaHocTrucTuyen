<!DOCTYPE html>
<html
  lang="vi"
  xmlns:th="http://www.thymeleaf.org"
  th:replace="~{/views/gdienChung/templateChung.html::view(~{::main}, ~{::title})}"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Trang chủ - GlobalEdu</title>
  </head>

  <body>
    <main class="homechung">
      <!-- Banner -->
      <!-- <div class="banner">Banner

      </div> -->
        <div class="container-fluid mt-4 px-0">
          <div class="row gx-0">
            <!-- Banner chính (trái) -->
            <div class="col-md-8 position-relative">
              <div id="mainBanner" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                  <div class="carousel-item active">
                    <img src="https://edurich.vn/data/sites/63f9dc7ee275cb643c8b456e/files/thumbnail/banner-k6.png" class="d-block w-100" alt="Banner 1">
                  </div>
                  <div class="carousel-item">
                    <img src="https://static.unica.vn/media/images/unica-cover.jpg" class="d-block w-100" alt="Banner 2">
                  </div>
                </div>

                <!-- Nút điều hướng trái -->
                <button class="carousel-control-prev" type="button" data-bs-target="#mainBanner" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Trước</span>
                </button>

                <!-- Nút điều hướng phải -->
                <button class="carousel-control-next" type="button" data-bs-target="#mainBanner" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Tiếp</span>
                </button>
              </div>
            </div>

            <!-- 2 ảnh phụ (phải) -->
            <div class="col-md-4 d-flex flex-column justify-content-between">
              <div class="mb-2">
                <img src="https://phuongnam.edu.vn/storage/media/202405/495b10d3-9a68-412c-a53a-aca90439350f.jpg" class="img-fluid w-100" alt="Ảnh phụ 1">
              </div>
              <div>
                <img src="https://younetmedia.com/wp-content/uploads/2023/10/Banner-Brands-Vietnam-1200x630-1.png" class="img-fluid w-100" alt="Ảnh phụ 2">
              </div>
            </div>
          </div>
        </div>


          


      <!-- Tiêu đề -->
      <div class="container mt-4">
        <h4><strong>Tất cả các kĩ năng cần có mọi nơi</strong></h4>
        <p>
          Từ các kĩ năng quan trọng, chuyên môn, GlobalEdu hỗ trợ phát triển cho
          bạn.
        </p>

        <!-- Tabs -->
        <div class="course-tabs">
          <ul class="nav nav-tabs" id="tabCourses" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" data-bs-toggle="tab">
                Khoa học dữ liệu
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" data-bs-toggle="tab">
                Phát triển phần mềm
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" data-bs-toggle="tab">
                Ứng dụng phần mềm
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" data-bs-toggle="tab">
                Phát triển Web
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" data-bs-toggle="tab">Giao tiếp</button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" data-bs-toggle="tab">
                Khả năng lãnh đạo
              </button>
            </li>
          </ul>
        </div>

        <!-- Danh sách khóa học -->
        <div class="courses-grid">
          <th:block th:each="khoaHoc, iterStat : ${khoaHocList}" th:if="${iterStat.index < 6}">
              <div class="card h-100 shadow-sm course-card"
                   th:onclick="|window.location.href='/khoaHoc/${khoaHoc.khoahocId}'|">
                  <img class="card-img-top"
                       th:src="${khoaHoc.anhBia != null and !#strings.isEmpty(khoaHoc.anhBia) ? '/images/' + khoaHoc.anhBia : '/images/default.png'}"
                       alt="Ảnh khoá học" />

                  <div class="card-body d-flex flex-column pb-0">
                      <p class="text-muted small" th:if="${khoaHoc.danhMuc}"
                         th:text="${khoaHoc.danhMuc.tenDanhMuc}">
                          Danh mục
                      </p>
                      <h5 class="card-title" th:text="${khoaHoc.tenKhoaHoc}">Tên khóa học</h5>
                      <p class="card-text" th:text="${#strings.abbreviate(khoaHoc.moTa, 80)}">Mô tả...</p>
                      <p class="card-text small text-muted mt-auto">
                          <i class="fas fa-chalkboard-teacher me-1"></i>
                          <span th:text="${khoaHoc.giangVien?.taikhoan?.name ?: 'Đang cập nhật'}">Tên giảng viên</span>
                      </p>
                  </div>

                  <div class="card-footer pt-0">
                      <div class="mb-2">
                          <p th:if="${khoaHoc.giaKhuyenMai != null and khoaHoc.giaKhuyenMai.doubleValue() > 0}"
                             class="card-text mb-0">
                              <span class="fw-bold text-danger me-2"
                                    th:text="${#numbers.formatDecimal(khoaHoc.giaKhuyenMai, 0, 'COMMA', 0, 'POINT') + ' ₫'}"></span>
                              <del class="text-muted"
                                   th:text="${#numbers.formatDecimal(khoaHoc.giagoc, 0, 'COMMA', 0, 'POINT') + ' ₫'}"></del>
                          </p>
                          <p th:if="${khoaHoc.giaKhuyenMai == null or khoaHoc.giaKhuyenMai.doubleValue() == 0}"
                             class="card-text fw-bold mb-0">
                              <span th:text="${#numbers.formatDecimal(khoaHoc.giagoc, 0, 'COMMA', 0, 'POINT') + ' ₫'}"></span>
                          </p>
                      </div>

                      <div class="d-flex justify-content-between align-items-center px-2 pb-2 gap-1">
                          <button type="button"
                                  class="btn btn-sm like-btn"
                                  th:id="'like-btn-' + ${khoaHoc.khoahocId}"
                                  th:classappend="${likedCourseIds.contains(khoaHoc.khoahocId)} ? 'btn-danger' : 'btn-outline-danger'"
                                  th:attr="data-id=${khoaHoc.khoahocId}">
                              <i class="fas fa-heart me-1"></i>
                              <span th:text="${likedCourseIds.contains(khoaHoc.khoahocId)} ? 'Bỏ thích' : 'Thích'"></span>
                              (<span th:id="'like-count-' + ${khoaHoc.khoahocId}"
                                    th:text="${khoaHoc.luotThich != null ? khoaHoc.luotThich : 0}"></span>)
                          </button>

                          <button type="button" class="btn btn-outline-primary btn-sm share-btn"
                                  data-bs-toggle="modal"
                                  th:data-bs-target="'#shareModal-' + ${khoaHoc.khoahocId}">
                              <i class="fas fa-share me-1"></i> Chia sẻ
                          </button>

                          <form th:action="@{/gio-hang/them}" method="post" class="d-inline add-to-cart-form">
                              <input type="hidden" name="khoaHocId" th:value="${khoaHoc.khoahocId}" />
                              <button type="submit" class="btn btn-outline-success btn-sm">
                                  <i class="fas fa-cart-plus me-1"></i> Giỏ hàng
                              </button>
                          </form>
                      </div>
                  </div>
              </div>

              <div class="modal fade" th:id="'shareModal-' + ${khoaHoc.khoahocId}" tabindex="-1" aria-hidden="true">
                  <div class="modal-dialog">
                      <div class="modal-content">
                          <div class="modal-header">
                              <h5 class="modal-title">Chia sẻ khóa học: <span th:text="${khoaHoc.tenKhoaHoc}"></span></h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <form th:action="@{/hoc-vien/share-course}" method="post">
                              <div class="modal-body">
                                      <input type="hidden" name="courseId" th:value="${khoaHoc.khoahocId}" />
                                      <div class="mb-3">
                                          <label for="recipientEmail" class="form-label">Email người nhận:</label>
                                          <input type="email" name="recipientEmail" class="form-control" required placeholder="nhapemail@example.com">
                                      </div>
                                      <p>Một email chứa thông tin và liên kết đến khóa học này sẽ được gửi đến địa chỉ trên.</p>
                              </div>
                              <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                                  <button type="submit" class="btn btn-primary">Gửi Email</button>
                              </div>
                          </form>
                      </div>
                  </div>
                  </div>
          </th:block>
      </div>

      <div th:if="${khoaHocList == null or #lists.isEmpty(khoaHocList)}">
          <p>Không có khóa học nổi bật nào.</p>
      </div>

      <div th:if="${share_success}" class="alert alert-success alert-dismissible fade show position-fixed bottom-0 end-0 m-3" role="alert">
          <strong th:text="${share_success}"></strong>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
      <div th:if="${share_error}" class="alert alert-danger alert-dismissible fade show position-fixed bottom-0 end-0 m-3" role="alert">
          <strong th:text="${share_error}"></strong>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
        <!-- Nút xem thêm -->
        <div class="text-center course-btn">
          <button class="btn btn-outline-primary">
            Xem thêm các khóa học Khoa học dữ liệu
          </button>
        </div>
      </div>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
      <script>
          document.addEventListener("DOMContentLoaded", function () {
              // Function to handle liking a course
              function likeCourse(id) {
                  fetch('/khoaHoc/' + id + '/like', { method: 'POST' })
                      .then(response => {
                          if (!response.ok) throw new Error('Lỗi khi gửi yêu cầu');
                          return response.json();
                      })
                      .then(data => {
                          const btn = document.getElementById('like-btn-' + id);
                          const btnTextSpan = btn.querySelector('span:first-of-type'); // Select the first span inside the button
                          const countSpan = document.getElementById('like-count-' + id);
                          countSpan.innerText = data.newLikeCount;

                          if (data.isLiked) {
                              btn.classList.add('btn-danger');
                              btn.classList.remove('btn-outline-danger');
                              btnTextSpan.innerText = 'Bỏ thích';
                          } else {
                              btn.classList.remove('btn-danger');
                              btn.classList.add('btn-outline-danger');
                              btnTextSpan.innerText = 'Thích';
                          }
                      })
                      .catch(err => console.error(err));
              }

              // Add event listeners for like buttons
              document.querySelectorAll(".like-btn").forEach((btn) => {
                  btn.addEventListener("click", function (e) {
                      e.stopPropagation(); // Prevent card click event
                      const courseId = btn.getAttribute("data-id");
                      likeCourse(courseId);
                  });
              });

              // Prevent propagation for share and add to cart buttons/forms
              document.querySelectorAll(".share-btn").forEach((btn) => {
                  btn.addEventListener("click", function (e) {
                      e.stopPropagation();
                  });
              });

              document.querySelectorAll(".add-to-cart-form").forEach((form) => {
                  form.addEventListener("click", function (e) {
                      e.stopPropagation();
                  });
              });
          });
      </script>
    </main>
  </body>
</html>
<style> .course-card {
  transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
  cursor: pointer; /* Added cursor pointer for clickable cards */
  display: flex; /* Ensure flex for consistent layout */
  flex-direction: column; /* Stack content vertically */
  height: 100%; /* Make cards fill their container */
}
.course-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}
/* Adjusted from course-thumb to card-img-top for better Bootstrap integration */
.card-img-top {
  height: 200px;
  object-fit: cover;
  width: 100%; /* Ensure image fills its container */
}
.course-info, .card-body {
  flex-grow: 1; /* Allow content to take available space */
  display: flex;
  flex-direction: column;
  padding-bottom: 0; /* Align with original .card-body pb-0 */
}
.course-price, .card-footer {
  background-color: transparent;
  border-top: none;
  padding-top: 0; /* Remove top padding if already handled by card-body */
}
.courses-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 24px; /* Consistent gap */
  margin-top: 24px; /* Spacing after heading */
}
.btn-big {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 12px 24px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 8px;
  text-decoration: none;
  color: #fff;
  background-color: #007bff;
  transition: background-color 0.3s ease;
}
.btn-big:hover {
  background-color: #0056b3;
}
.btn-big.green {
  background-color: #28a745;
}
.btn-big.green:hover {
  background-color: #218838;
}
.btn-detail {
  padding: 8px 16px;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
}
.btn-outline {
  background-color: transparent;
  border: 1px solid #007bff;
  color: #007bff;
}
.btn-outline.liked {
  background-color: #dc3545; /* Red for liked */
  color: #fff;
  border-color: #dc3545;
}
.btn-outline:hover {
  background-color: #007bff;
  color: #fff;
}
.btn-outline.liked:hover {
  background-color: #c82333;
  border-color: #bd2130;
}</style>