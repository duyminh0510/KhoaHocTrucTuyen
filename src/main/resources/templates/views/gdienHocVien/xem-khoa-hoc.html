<!DOCTYPE html>
<html lang="en" th:replace="~{/views/gdienChung/templateChung.html::view(~{::main}, ~{::title})}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xem khóa học</title>
</head>

<body>
    <main class="xemkhoahoc">
        <div th:if="${khoaHoc != null}">
            <div class="container">
                <div class="row gx-1">
                    <div class="col-lg-8">
                        <div class="border px-4 d-flex flex-column" style="height: 350px; overflow: hidden;">
                            <div th:if="${baiGiang != null}">
                                <!-- VIDEO -->
                                <div th:if="${baiGiang.loaiBaiGiang.name() == 'VIDEO'}">
                                    <iframe class="w-100" height="350" th:src="${baiGiang.videoBaiGiang.url_video}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
                                        </iframe>

                                </div>

                                <!-- BÀI VIẾT -->
                                <div th:if="${baiGiang.loaiBaiGiang.name() == 'TAILIEU'}" class="flex-grow-1 overflow-auto">
                                    <div th:utext="${baiViet.noidung}"></div>
                                </div>

                                <!-- TRẮC NGHIỆM -->
                                <div th:if="${baiGiang.loaiBaiGiang.name() == 'TRACNGHIEM'}" class="flex-grow-1 overflow-auto">
                                    <p><strong>Câu hỏi trắc nghiệm sẽ hiển
                                                thị
                                                tại đây.</strong></p>
                                    <!-- Bạn có thể lặp qua baiTracNghiem.cauHoiList nếu muốn -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card shadow-sm rounded-4 mb-4 border-0">
                            <div class="card-body" id="chuong-list">
                                <div th:if="${#lists.isEmpty(chuongs)}">
                                    <p class="text-muted fst-italic">Chưa có chương nào cho khóa học này.</p>
                                </div>

                                <div th:if="${!#lists.isEmpty(chuongs)}" class="accordion" id="accordionChuong">
                                    <div class="accordion-item mb-2" th:each="chuong, iterStat : ${chuongs}">
                                        <h2 class="accordion-header" th:attr="id='heading' + ${iterStat.index}">
                                            <button class="accordion-button collapsed bg-light" type="button" data-bs-toggle="collapse" th:attr="data-bs-target='#collapse' + ${iterStat.index}" aria-expanded="false" th:attrappend="aria-controls='collapse' + ${iterStat.index}">
                                                    <strong
                                                        th:text="${chuong.tenchuong}">Tên
                                                        chương</strong>
                                                </button>
                                        </h2>
                                        <div th:attr="id='collapse' + ${iterStat.index}" class="accordion-collapse collapse" th:classappend="${chuong.chuongId == chuongDangMoId} ? ' show' : ''" th:attrappend="aria-labelledby='heading' + ${iterStat.index}" data-bs-parent="#accordionChuong">

                                            <div class="accordion-body">

                                                <!-- Có bài giảng -->
                                                <ul class="list-group list-group-flush mb-0" th:if="${chuong.baiGiangs != null && !#lists.isEmpty(chuong.baiGiangs)}">
                                                    <li class="list-group-item ps-4" th:each="baiGiang : ${chuong.baiGiangs}" th:classappend="${baiGiang.baiGiangId == baiGiangDangHocId} ? 'active-bai-giang' : ''">

                                                        <a th:href="@{'/khoa-hoc/bai-giang/' + ${baiGiang.baiGiangId}}" class="text-decoration-none text-dark">
                                                            <i class="fas fa-book-open text-primary me-2"></i>
                                                            <span th:text="${baiGiang.tenBaiGiang}">Tên
                                                                    bài
                                                                    giảng</span>
                                                        </a>

                                                    </li>
                                                </ul>

                                                <!-- Không có bài giảng -->
                                                <p th:if="${chuong.baiGiangs == null || #lists.isEmpty(chuong.baiGiangs)}" class="text-muted fst-italic mt-2 ps-2">
                                                    <i class="fas fa-exclamation-circle me-1"></i> Chưa có bài giảng nào trong chương này.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <style>
            .active-bai-giang {
                background-color: #eaf4ff;
                font-weight: bold;
                border-left: 4px solid #007bff;
            }
        </style>

    </main>

</body>

</html>