<!DOCTYPE html>
<html lang="vi"
    th:replace="~{/views/gdienChung/templateChung.html::view(~{::main}, ~{::title})}">

    <head>
        <meta charset="UTF-8" />
        <title>Thêm giá khóa học</title>
    </head>

    <body>
        <main class="themkhoahoc">
            <div class="container">
                <h2 class="main-title mt-5">THÊM GIÁ - BƯỚC 2</h2>
                <form class="mb-5"
                    th:action="@{/giangvien/them-moi-khoa-hoc/save-price}"
                    th:object="${course}" method="post">
                    <input type="hidden" th:field="*{khoahocId}" />

                    <label>Giá khóa học (VND):</label>
                    <input type="number" th:field="*{giagoc}" name="giagoc"
                        min="1000" step="1000"
                        placeholder="Nhập giá gốc, VD: 500000" required
                        oninvalid="this.setCustomValidity('Giá gốc phải lớn hơn 0 và chia hết cho 1000')"
                        oninput="this.setCustomValidity('')" />

                    <label>Phần trăm khuyến mãi (%):</label>
                    <input type="number" th:field="*{phanTramGiam}"
                        name="phanTramGiam" min="0" max="100"
                        placeholder="20" />

                    <label>Giá sau khi khuyến mãi (VND):</label>
                    <input type="text" id="giaKhuyenMai" readonly />

                    <label>Ngày bắt đầu:</label>
                    <input type="datetime-local" th:field="*{ngaybatdau}" />

                    <label>Ngày kết thúc:</label>
                    <input type="datetime-local" th:field="*{ngayketthuc}" />

                    <div class="d-flex justify-content-end mt-4">
                        <button type="button" class="btn custom-outline me-2"
                            th:onclick="|window.location.href='/giangvien/them-moi-khoa-hoc?khoahocId=${course.khoahocId}'|">
                            ← Quay lại
                        </button>
                        <button class="btn custom-outline" type="submit">Hoàn
                            tất</button>
                    </div>

                </form>

            </div>

            <script>
            function tinhGiaSauGiam() {
                const giagoc = parseFloat(document.querySelector('[name="giagoc"]').value) || 0;
                const phantramInput = document.querySelector('[name="phanTramGiam"]');
                const phantramStr = phantramInput.value.trim();
                const giaKhuyenMaiField = document.getElementById("giaKhuyenMai");

                if (phantramStr === "") {
                    giaKhuyenMaiField.value = ""; // Xoá giá khuyến mãi nếu không nhập phần trăm
                    return;
                }

                const phantram = parseFloat(phantramStr);
                if (isNaN(phantram)) {
                    giaKhuyenMaiField.value = ""; // Xoá nếu phần trăm không hợp lệ
                    return;
                }

                const giacuoi = giagoc - (giagoc * phantram / 100);
                giaKhuyenMaiField.value = giacuoi.toLocaleString('vi-VN') + " VND";
            }

            document.addEventListener("DOMContentLoaded", function() {
                const giagocInput = document.querySelector('[name="giagoc"]');
                const giamInput = document.querySelector('[name="phanTramGiam"]');

                giagocInput.addEventListener("input", tinhGiaSauGiam);
                giamInput.addEventListener("input", tinhGiaSauGiam);
            });
        </script>

        </main>
    </body>

</html>