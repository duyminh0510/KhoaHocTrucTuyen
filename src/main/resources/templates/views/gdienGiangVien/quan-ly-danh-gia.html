<!DOCTYPE html>
<html lang="vi"
    th:replace="~{/views/gdienChung/templateChung.html::view(~{::main}, ~{::title})}">

    <head>
        <meta charset="UTF-8">
        <title>ƒê√°nh gi√° kh√≥a h·ªçc</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet">
        <style>
        .review-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background-size: cover;
            background-position: center;
            margin-right: 15px;
        }
        
        .review-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }
        
        .review-content {
            flex-grow: 1;
        }
        
        .review-stars {
            color: #ffc107;
        }
        
        .review-date {
            font-size: 0.9em;
            color: #6c757d;
        }
    </style>
    </head>

    <body class="bg-light">
        <main>
            <div class="container py-4">

                <h2 th:if="${khoaHocChiTiet == null}" class="mb-4">üìò T·ªïng quan
                    ƒë√°nh gi√° kh√≥a h·ªçc c·ªßa t√¥i</h2>
                <h2 th:if="${khoaHocChiTiet != null}" class="mb-4">üìò Chi ti·∫øt
                    ƒë√°nh gi√°: <span
                        th:text="${khoaHocChiTiet.tenKhoaHoc}"></span></h2>

                <form method="get"
                    th:action="@{/giangvien/danh-gia-tu-khoa-hoc}"
                    class="row g-3 align-items-end mb-4">
                    <div class="col-md-4">
                        <label class="form-label">Kh√≥a h·ªçc:</label>
                        <select name="khoahocId" class="form-select">
                            <option value>-- T·∫•t c·∫£ --</option>
                            <option th:each="kh : ${dsKhoaHoc}"
                                th:value="${kh.khoahocId}"
                                th:text="${kh.tenKhoaHoc}"
                                th:selected="${kh.khoahocId == khoaHocDaChon}"></option>
                        </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label">S·ªë sao:</label>
                        <select name="sao" class="form-select">
                            <option value>-- T·∫•t c·∫£ --</option>
                            <option th:each="i : ${#numbers.sequence(1,5)}"
                                th:value="${i}" th:text="${i + ' sao'}"
                                th:selected="${i == saoDaChon}"></option>
                        </select>
                    </div>

                    <div class="col-md-auto">
                        <button type="submit"
                            class="btn btn-primary">L·ªçc</button>
                        <a th:href="@{/giangvien/danh-gia-tu-khoa-hoc}"
                            class="btn btn-secondary ms-2">X√≥a l·ªçc</a>
                    </div>
                </form>

                <!-- T·ªïng quan -->
                <div th:if="${khoaHocChiTiet == null}">
                    <div class="table-responsive">
                        <table
                            class="table table-bordered table-striped align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>T√™n kh√≥a h·ªçc</th>
                                    <th>S·ªë l∆∞·ª£t ƒë√°nh gi√°</th>
                                    <th>ƒêi·ªÉm trung b√¨nh</th>
                                    <th>H√†nh ƒë·ªông</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="row : ${tongQuanDanhGia}">
                                    <td
                                        th:text="${row.khoahoc.tenKhoaHoc}"></td>
                                    <td th:text="${row.tong}"></td>
                                    <td
                                        th:text="${#numbers.formatDecimal(row.diemTB, 1, 1)} + ' ‚≠êÔ∏è'"></td>
                                    <td>
                                        <a
                                            th:href="@{/giangvien/danh-gia-tu-khoa-hoc(khoahocId=${row.khoahoc.khoahocId})}"
                                            class="btn btn-link btn-sm">Xem chi
                                            ti·∫øt</a>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Chi ti·∫øt -->
                <div th:if="${khoaHocChiTiet != null}">
                    <div class="card mb-4">
                        <div class="card-body">
                            <h5 class="card-title">üìò Th√¥ng tin kh√≥a h·ªçc</h5>
                            <p><strong>M√£ kh√≥a h·ªçc:</strong> <span
                                    th:text="${khoaHocChiTiet.khoahocId}"></span></p>
                            <p><strong>T√™n kh√≥a h·ªçc:</strong> <span
                                    th:text="${khoaHocChiTiet.tenKhoaHoc}"></span></p>
                            <p th:if="${khoaHocChiTiet.moTa != null}">
                                <strong>M√¥ t·∫£:</strong> <span
                                    th:text="${khoaHocChiTiet.moTa}"></span>
                            </p>
                            <p><strong>T·ªïng l∆∞·ª£t ƒë√°nh gi√°:</strong> <span
                                    th:text="${tongLuot}"></span></p>
                            <p><strong>ƒêi·ªÉm trung b√¨nh:</strong> <span
                                    th:text="${#numbers.formatDecimal(diemTrungBinh, 1, 1)} + ' ‚≠êÔ∏è'"></span></p>
                        </div>
                    </div>

                    <h4 class="mb-3">üìù Danh s√°ch ƒë√°nh gi√°</h4>

                    <div th:if="${#lists.isEmpty(dsDanhGia)}">
                        <div class="alert alert-warning">‚ö†Ô∏è Kh√¥ng c√≥ ƒë√°nh gi√°
                            n√†o ph√π h·ª£p.</div>
                    </div>

                    <div th:each="dg : ${dsDanhGia}"
                        class="review-item bg-white">
                        <!-- Avatar -->
                        <div class="d-flex align-items-center">
                            <img th:src="${dg.taikhoan.avatar}" alt="Avatar"
                                class="rounded-circle me-2"
                                style="width: 40px; height: 40px; object-fit: cover;" />
                        </div>

                        <!-- N·ªôi dung -->
                        <div class="review-content">
                            <div class="d-flex justify-content-between">
                                <div class="fw-bold"
                                    th:text="${dg.taikhoan.name}">T√™n ng∆∞·ªùi
                                    d√πng</div>
                                <div class="review-date"
                                    th:text="${#temporals.format(dg.ngayDanhGia, 'dd/MM/yyyy')}">
                                    22/07/2025
                                </div>
                            </div>

                            <div class="review-stars my-1">
                                <span
                                    th:each="i : ${#numbers.sequence(1, dg.diemDanhGia)}">‚òÖ</span>
                                <span th:if="${dg.diemDanhGia < 5}"
                                    th:each="j : ${#numbers.sequence(dg.diemDanhGia + 1, 5)}"
                                    style="color: #dee2e6;">‚òÖ</span>
                            </div>

                            <div class="review-text" th:text="${dg.noiDung}">N·ªôi
                                dung ƒë√°nh gi√°</div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <a th:href="@{/giangvien/danh-gia-tu-khoa-hoc}"
                            class="btn btn-outline-primary">‚Üê Quay l·∫°i t·ªïng
                            quan</a>
                    </div>
                </div>

            </div>

            <script
                src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        </main>
    </body>

</html>