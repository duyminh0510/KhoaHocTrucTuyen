<!DOCTYPE html>
<html lang="vi" th:replace="~{/views/gdienChung/templateChung.html::view(~{::main}, ~{::title})}">

<head>
    <meta charset="UTF-8">
    <title>Thống kê giảng viên</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
    <main class="thongke">
        <div class="thongke-container">
            <div class="thongke-header">
                <i class="fas fa-chart-line"></i>
                <h1>Bảng điều khiển giảng viên</h1>
            </div>
            <div class="stat-grid">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <h2 th:text="${tongHocVien}">0</h2>
                    <p>Học viên đăng ký</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-book"></i>
                    <h2 th:text="${soKhoaHoc}">0</h2>
                    <p>Khóa học đang dạy</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-star"></i>
                    <h2 th:text="${#numbers.formatDecimal(diemTrungBinh, 1, 'COMMA', 1, 'POINT')}">0</h2>
                    <p>Điểm đánh giá trung bình</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-dollar-sign"></i>
                    <h2 th:text="${#numbers.formatDecimal(doanhThuThang, 0, 'COMMA', 0, 'POINT')} + '₫'">0₫</h2>
                    <p>Tổng doanh thu</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-coins"></i>
                    <h2 th:text="${#numbers.formatDecimal(tongDoanhThu, 0, 'COMMA', 0, 'POINT')} + '₫'">0₫</h2>
                    <p>Tổng tiền nhận</p>
                </div>
            </div>

        </div>

        <div class="chart-placeholder" style="margin-top: 32px;">
            <h3>Biểu đồ doanh thu theo khóa học</h3>
            <canvas id="doanhThuChart" width="600" height="250"></canvas>
        </div>

        <div class="table-container" style="margin-top: 32px;">
            <h3>Thống kê doanh thu từng khóa học</h3>
            <table border="1" style="width:100%; text-align:center;">
                <thead>
                    <tr>
                        <th>Tên khóa học</th>
                        <th>Số lượt đăng ký</th>
                        <th>Tổng tiền giao dịch</th>
                        <th>Tổng tiền nhận</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="item : ${doanhThuKhoaHoc}">
                        <td th:text="${item.tenKhoaHoc}">Tên</td>
                        <td th:text="${item.soLuotDangKy}">0</td>
                        <td th:text="${#numbers.formatDecimal(item.tongTienGiaoDich, 0, 'COMMA', 0, 'POINT')} + '₫'">
                            0₫</td>
                        <td th:text="${#numbers.formatDecimal(item.tongTienNhan, 0, 'COMMA', 0, 'POINT')} + '₫'">0₫
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        </div>

        <!-- Biểu đồ doanh thu -->
        <script th:inline="javascript">
            /*<![CDATA[*/
            var doanhThuKhoaHoc = /*[[${doanhThuKhoaHoc}]]*/[];

            var labels = doanhThuKhoaHoc.map(function (item) {
                return item.tenKhoaHoc;
            });

            var data = doanhThuKhoaHoc.map(function (item) {
                return item.tongTienNhan;
            });

            console.log("labels:", labels);
            console.log("data:", data);

            var ctx = document.getElementById('doanhThuChart').getContext('2d');
            if (labels.length > 0 && data.length > 0) {
                var doanhThuChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Doanh thu nhận được',
                            data: data,
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function (value) {
                                        return value.toLocaleString('vi-VN') + '₫';
                                    }
                                }
                            }
                        }
                    }
                });
            } else {
                console.log("Không có dữ liệu để vẽ biểu đồ");
            }
            /*]]>*/
        </script>
    </main>
</body>

</html>