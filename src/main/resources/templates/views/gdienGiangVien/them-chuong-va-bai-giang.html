<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
    th:replace="~{/views/gdienChung/templateChung.html::view(~{::main}, ~{::title})}">

    <head>
        <meta charset="UTF-8">
        <title>C√°c b∆∞·ªõc t·∫°o kh√≥a h·ªçc</title>
    </head>

    <body>
        <main class=" tao-khoa-hoc-page container py-5"
            style="padding-left: 100px; padding-right: 100px;">
            <div class="tieude">
                <h3>‚ûïT·∫°o n·ªôi dung kh√≥a h·ªçc</h3>
            </div>

            <!-- Container th√¥ng b√°o -->
            <div class="my-3">
                <!-- Th√¥ng b√°o th√†nh c√¥ng -->
                <div th:if="${thongbao}"
                    class="alert alert-success alert-dismissible fade show shadow-sm rounded px-4 py-3 border-0"
                    role="alert" style="background-color: #e6f4ea;">
                    <span th:text="${thongbao}" class="fw-medium">Th√¥ng
                        b√°o</span>
                    <button type="button" class="btn-close"
                        data-bs-dismiss="alert" aria-label="ƒê√≥ng"></button>
                </div>

                <!-- Th√¥ng b√°o l·ªói -->
                <div th:if="${loi}"
                    class="alert alert-danger alert-dismissible fade show shadow-sm rounded px-4 py-3 border-0"
                    role="alert" style="background-color: #fbeaea;">
                    <span th:text="${loi}" class="fw-medium">L·ªói</span>
                    <button type="button" class="btn-close"
                        data-bs-dismiss="alert" aria-label="ƒê√≥ng"></button>
                </div>

                <!-- Hi·ªÉn th·ªã l·ªói -->
                <div th:if="${loidinhdang}" th:utext="${loidinhdang}"
                    class="alert alert-danger"></div>
            </div>

            <form th:if="${chuongForm != null}"
                th:action="@{/giangvien/them-moi-khoa-hoc/luu-chuong-va-baigiang}"
                th:object="${chuongForm}" method="post">
                <input type="hidden" name="khoahocId"
                    th:value="${khoahoc.khoahocId}" />

                <div class="text-end mt-3">
                    <button type="submit" class="btn text-white"
                        style="background-color: #1B263B;">L∆∞u b·∫£n
                        nh√°p</button>
                </div>

                <div id="chuong-container"
                    th:if="${chuongForm.chuongs != null}">
                    <div th:each="chuong, cStat : ${chuongForm.chuongs}"
                        class="card mt-4 chuong-item"
                        style="background-color: #E9ECEF;">
                        <div
                            class="card-header d-flex justify-content-between align-items-center">
                            <strong class="chuong-title"
                                th:text="'Ph·∫ßn ' + ${cStat.index + 1}">Ph·∫ßn</strong>
                            <div class="d-flex gap-2">
                                <button type="submit"
                                    class="btn btn-sm btn-success"
                                    th:name="saveChuongIndex"
                                    th:value="${cStat.index}"
                                    title="L∆∞u ch∆∞∆°ng n√†y">
                                    <i class="bi bi-save"></i>
                                </button>

                                <button type="button"
                                    class="btn btn-sm btn-outline-secondary btn-toggle-mota"
                                    data-bs-toggle="tooltip"
                                    data-bs-trigger="hover"
                                    data-bs-placement="top" title="M√¥ t·∫£">
                                    <i class="bi bi-plus-circle"></i>
                                </button>

                                <button type="button"
                                    class="btn btn-sm btn-danger"
                                    th:onclick="'moModalXoaChuong(' + ${chuong.chuongId} + ')'">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>

                        <div class="card-body">
                            <label class="form-label mb-2">üìöT√™n ch∆∞∆°ng:</label>
                            <input type="text" class="form-control mb-3"
                                th:name="'chuongs[' + ${cStat.index} + '].tenchuong'"
                                th:value="${chuong.tenchuong}"
                                placeholder="nh·∫≠p t√™n ch∆∞∆°ng" />

                            <input type="hidden"
                                th:name="'chuongs[' + ${cStat.index} + '].chuongId'"
                                th:value="${chuong.chuongId}" />

                            <div class="mo-ta-chuong mt-2 mb-3"
                                style="display:none;">
                                <label class="form-label mb-2">üìò M√¥ t·∫£
                                    ch∆∞∆°ng:</label>
                                <textarea class="form-control" rows="2"
                                    th:name="'chuongs[' + ${cStat.index} + '].mota'"
                                    th:text="${chuong.mota}"
                                    placeholder="nh·∫≠p m√¥ t·∫£ ch∆∞∆°ng"></textarea>
                            </div>

                            <div class="bai-giang-container">
                                <div
                                    th:each="baiGiang, bStat : ${chuong.baiGiangs}"
                                    class="baigiang-item border p-3 rounded mb-3">

                                    <input type="hidden"
                                        th:name="'chuongs[' + ${cStat.index} + '].baiGiangs[' + ${bStat.index} + '].baiGiangId'"
                                        th:value="${baiGiang.baiGiangId}" />

                                    <div
                                        class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2">
                                        <strong
                                            class="baigiang-title flex-grow-1"
                                            th:text="'B√†i gi·∫£ng ' + ${bStat.index + 1}">B√†i
                                            gi·∫£ng</strong>

                                        <div class="d-flex gap-2">
                                            <button type="button"
                                                class="btn btn-outline-primary btn-sm btn-chon-loai"
                                                data-value="VIDEO">Video</button>
                                            <button type="button"
                                                class="btn btn-outline-primary btn-sm btn-chon-loai"
                                                data-value="TAILIEU">B√†i
                                                vi·∫øt</button>
                                            <button type="button"
                                                class="btn btn-outline-primary btn-sm btn-chon-loai"
                                                data-value="TRACNGHIEM">Tr·∫Øc
                                                nghi·ªám</button>
                                        </div>

                                        <!-- ‚úÖ N√∫t l∆∞u b√†i gi·∫£ng -->
                                        <button type="submit"
                                            class="btn btn-sm btn-success"
                                            th:name="saveBaiGiang"
                                            th:value="${cStat.index + '-' + bStat.index}"
                                            title="L∆∞u b√†i gi·∫£ng n√†y">
                                            <i class="bi bi-save"></i>
                                        </button>

                                        <!-- N·∫øu ƒë√£ c√≥ ID ‚Üí d√πng modal x√°c nh·∫≠n -->
                                        <button type="button"
                                            class="btn btn-sm btn-outline-danger"
                                            th:if="${baiGiang.baiGiangId != null}"
                                            th:onclick="'moModalXoaBaiGiang(' + ${baiGiang.baiGiangId} + ')'"
                                            title="X√≥a b√†i gi·∫£ng"
                                            data-bs-toggle="tooltip">
                                            <i class="bi bi-trash"></i>
                                        </button>

                                    </div>

                                    <label class="form-label mb-2">üìù T√™n b√†i
                                        h·ªçc:</label>
                                    <input type="text" class="form-control mb-2"
                                        th:name="'chuongs[' + ${cStat.index} + '].baiGiangs[' + ${bStat.index} + '].tenBaiGiang'"
                                        th:value="${baiGiang.tenBaiGiang}"
                                        placeholder="nh·∫≠p t√™n b√†i h·ªçc" />

                                    <input type="hidden"
                                        class="loai-bai-giang-input"
                                        th:name="'chuongs[' + ${cStat.index} + '].baiGiangs[' + ${bStat.index} + '].loaiBaiGiang'"
                                        th:value="${baiGiang.loaiBaiGiang}" />

                                    <label class="form-label mb-2">üé¨ N·ªôi
                                        dung:</label>
                                    <textarea class="form-control"
                                        th:name="'chuongs[' + ${cStat.index} + '].baiGiangs[' + ${bStat.index} + '].mota'"
                                        th:text="${baiGiang.mota}"
                                        placeholder="nh·∫≠p m√¥ t·∫£ n·ªôi dung"></textarea>

                                    <!-- VIDEO -->
                                    <div class="video-fields mt-2"
                                        th:style="${baiGiang.loaiBaiGiang?.name() == 'VIDEO'} ? 'display: block;' : 'display: none;'">
                                        <label
                                            class="form-label mb-2"><strong>üé•
                                                ƒê∆∞·ªùng
                                                d·∫´n video:</strong></label>
                                        <input type="text"
                                            class="form-control mb-2"
                                            th:name="'chuongs[' + ${cStat.index} + '].baiGiangs[' + ${bStat.index} + '].videoBaiGiang.url_video'"
                                            th:value="${baiGiang.videoBaiGiang?.url_video}"
                                            placeholder="h√£y g·∫Øn ƒë∆∞·ªùng d·∫´n video"
                                            th:disabled="${baiGiang.loaiBaiGiang?.name() != 'VIDEO'}" />
                                        <p class="m-2"><i>B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng
                                                ƒë∆∞·ªùng d·∫´n video ho·∫∑c g·∫Øn ƒë∆∞·ªùng
                                                d·∫´n link.</i></p>

                                        <label
                                            class="form-label mb-2"><strong>üìù
                                                M√¥ t·∫£
                                                video:</strong></label>
                                        <textarea class="form-control"
                                            th:name="'chuongs[' + ${cStat.index} + '].baiGiangs[' + ${bStat.index} + '].videoBaiGiang.mota'"
                                            th:text="${baiGiang.videoBaiGiang?.mota}"
                                            placeholder="M√¥ t·∫£ video (t√πy ch·ªçn)"
                                            th:disabled="${baiGiang.loaiBaiGiang?.name() != 'VIDEO'}"></textarea>
                                        <p class="m-2"><i>M√¥ t·∫£ v·ªÅ video c·ªßa
                                                b·∫°n.</i></p>
                                    </div>

                                    <!-- B√ÄI VI·∫æT -->
                                    <div class="baiviet-fields mt-2"
                                        th:style="${baiGiang.loaiBaiGiang?.name() == 'TAILIEU'} ? 'display: block;' : 'display: none;'">

                                        <label class="form-label mb-2">
                                            <strong>üìÑ N·ªôi
                                                dung t√†i li·ªáu:</strong></label>
                                        <textarea class="form-control"
                                            th:name="'chuongs[' + ${cStat.index} + '].baiGiangs[' + ${bStat.index} + '].baiViet.noidung'"
                                            th:text="${baiGiang.baiViet?.noidung}"
                                            placeholder="N·ªôi dung b√†i vi·∫øt"
                                            th:disabled="${baiGiang.loaiBaiGiang?.name() != 'TAILIEU'}"></textarea>
                                        <p class="m-2"><i>ƒêi·ªÅn chi ti·∫øt n·ªôi dung
                                                gi·∫£ng d·∫°y ho·∫∑c ph·∫ßn b√†i t·∫≠p k√®m
                                                theo.</i></p>
                                    </div>

                                    <div class="tracnghiem-fields mt-2"
                                        th:style="${baiGiang.loaiBaiGiang?.name() == 'TRACNGHIEM'} ? 'display:block;' : 'display:none;'">

                                        <a
                                            th:href="@{/giangvien/cau-hoi/them(baiGiangId=${baiGiang.baiGiangId})}"
                                            class="btn btn-outline-primary btn-sm">
                                            ‚ûï Th√™m ho·∫∑c s·ª≠a c√¢u h·ªèi
                                        </a>

                                    </div>

                                </div>
                            </div>

                            <button type="button"
                                class="btn btn-outline-secondary mt-2"
                                onclick="themBaiGiang(this)">
                                + M·ª•c gi√°o tr√¨nh
                            </button>
                        </div>
                    </div>
                </div>

                <button type="button" class="btn btn-outline-primary mt-3"
                    onclick="themChuong()">+ Ph·∫ßn</button>
                <button type="submit" class="btn text-white mt-3"
                    style="background-color: #1B263B;">L∆∞u b·∫£n
                    nh√°p</button>
            </form>

            <!-- Modal x√°c nh·∫≠n x√≥a ch∆∞∆°ng -->
            <div class="modal fade" id="modalXoaChuong" tabindex="-1"
                aria-labelledby="xoaChuongLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <form method="post"
                        th:action="@{/giangvien/them-moi-khoa-hoc/xoa-chuong}">
                        <input type="hidden" name="chuongId"
                            id="inputChuongIdXoa" />
                        <input type="hidden" name="khoahocId"
                            th:value="${khoahoc.khoahocId}" />
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="xoaChuongLabel">X√°c
                                    nh·∫≠n x√≥a ch∆∞∆°ng</h5>
                                <button type="button" class="btn-close"
                                    data-bs-dismiss="modal"
                                    aria-label="ƒê√≥ng"></button>
                            </div>
                            <div class="modal-body">
                                B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ch∆∞∆°ng n√†y? T·∫•t c·∫£ b√†i
                                gi·∫£ng trong ch∆∞∆°ng c≈©ng s·∫Ω b·ªã x√≥a.
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary"
                                    data-bs-dismiss="modal">H·ªßy</button>
                                <button type="submit"
                                    class="btn btn-danger">X√≥a</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Modal x√°c nh·∫≠n x√≥a b√†i gi·∫£ng -->
            <div class="modal fade" id="modalXoaBaiGiang" tabindex="-1"
                aria-labelledby="xoaBaiGiangLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <form method="post"
                        th:action="@{/giangvien/them-moi-khoa-hoc/xoa-baigiang}">
                        <input type="hidden" name="baiGiangId"
                            id="inputBaiGiangIdXoa" />
                        <input type="hidden" name="khoahocId"
                            th:value="${khoahoc.khoahocId}" />
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title"
                                    id="xoaBaiGiangLabel">X√°c nh·∫≠n x√≥a b√†i gi·∫£ng
                                </h5>
                                <button type="button" class="btn-close"
                                    data-bs-dismiss="modal"
                                    aria-label="ƒê√≥ng"></button>
                            </div>
                            <div class="modal-body">
                                B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i gi·∫£ng n√†y?
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary"
                                    data-bs-dismiss="modal">H·ªßy</button>
                                <button type="submit"
                                    class="btn btn-danger">X√≥a</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Template ·∫©n -->
            <template id="chuong-template">
                <div class="card mt-4 chuong-item"
                    style="background-color: #E9ECEF;">
                    <div
                        class="card-header d-flex justify-content-between align-items-center">
                        <strong class="chuong-title">Ph·∫ßn</strong>
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-sm btn-success"
                                name="saveChuongIndex" value="__index__"
                                title="L∆∞u ch∆∞∆°ng n√†y">
                                <i class="bi bi-save"></i>
                            </button>

                            <button type="button"
                                class="btn btn-sm btn-outline-secondary btn-toggle-mota"
                                data-bs-toggle="tooltip"
                                data-bs-trigger="hover"
                                data-bs-placement="top" title="M√¥ t·∫£">
                                <i class="bi bi-plus-circle"></i>
                            </button>

                            <button type="button" class="btn btn-sm btn-danger"
                                onclick="xoaChuong(this)">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="card-body">
                        <label class="form-label mb-2">üìö T√™n ch∆∞∆°ng:</label>
                        <input type="text" name="chuongs[__index__].tenchuong"
                            class="form-control mb-3"
                            placeholder="nh·∫≠p t√™n ch∆∞∆°ng">

                        <div class="mo-ta-chuong mt-2 mb-3"
                            style="display: none;">
                            <label class="form-label mb-2">üìò M√¥ t·∫£
                                ch∆∞∆°ng:</label>
                            <textarea class="form-control"
                                name="chuongs[__index__].mota"
                                rows="2"
                                placeholder="nh·∫≠p m√¥ t·∫£ ch∆∞∆°ng"></textarea>
                        </div>

                        <div class="bai-giang-container"></div>
                        <button type="button"
                            class="btn btn-outline-secondary mt-2"
                            onclick="themBaiGiang(this)">+ M·ª•c gi√°o
                            tr√¨nh</button>
                    </div>
                </div>
            </template>

            <template id="baigiang-template">
                <div class="baigiang-item border p-3 rounded mb-3">
                    <div
                        class="d-flex justify-content-between align-items-center mb-2">
                        <strong class="baigiang-title">B√†i gi·∫£ng </strong>
                        <div class="d-flex gap-2">
                            <!-- C√°c n√∫t ch·ªçn lo·∫°i b√†i gi·∫£ng -->

                            <div class="d-flex gap-2">
                                <button type="button"
                                    class="btn btn-outline-primary btn-sm btn-chon-loai"
                                    data-value="VIDEO">Video</button>
                                <button type="button"
                                    class="btn btn-outline-primary btn-sm btn-chon-loai"
                                    data-value="TAILIEU">B√†i
                                    vi·∫øt</button>
                                <button type="button"
                                    class="btn btn-outline-primary btn-sm btn-chon-loai"
                                    data-value="TRACNGHIEM">Tr·∫Øc
                                    nghi·ªám</button>
                            </div>

                            <!-- ‚úÖ N√∫t l∆∞u b√†i gi·∫£ng -->
                            <button type="submit"
                                class="btn btn-sm btn-success"
                                name="saveBaiGiang"
                                value="__cIndex__-__bIndex__"
                                title="L∆∞u b√†i gi·∫£ng n√†y">
                                <i class="bi bi-save"></i>
                            </button>

                            <button type="button"
                                class="btn btn-sm btn-outline-danger"
                                onclick="xoaBaiGiang(this)"
                                title="X√≥a b√†i gi·∫£ng"
                                data-bs-toggle="tooltip">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>

                    <label class="form-label mb-2">üìù T√™n b√†i h·ªçc:</label>
                    <input type="text"
                        name="chuongs[__cIndex__].baiGiangs[__bIndex__].tenBaiGiang"
                        class="form-control mb-2"
                        placeholder="nh·∫≠p t√™n b√†i h·ªçc">

                    <input type="hidden"
                        name="chuongs[__cIndex__].baiGiangs[__bIndex__].loaiBaiGiang"
                        class="loai-bai-giang-input" value />

                    <label class="form-label mb-2">üé¨ N·ªôi dung:</label>
                    <textarea
                        name="chuongs[__cIndex__].baiGiangs[__bIndex__].mota"
                        class="form-control"
                        placeholder="nh·∫≠p m√¥ t·∫£ n·ªôi dung"></textarea>

                    <!-- VIDEO -->
                    <div class="video-fields mt-2">
                        <label class="form-label mb-2"><strong>üé• ƒê∆∞·ªùng d·∫´n
                                video:</strong></label>
                        <input type="text"
                            name="chuongs[__cIndex__].baiGiangs[__bIndex__].videoBaiGiang.url_video"
                            class="form-control mb-2"
                            placeholder="h√£y g·∫Øn ƒë∆∞·ªùng d·∫´n video">
                        <p class="m-2"><i>B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng ƒë∆∞·ªùng d·∫´n video
                                ho·∫∑c g·∫Øn ƒë∆∞·ªùng d·∫´n link.</i></p>

                        <label class="form-label mb-2"><strong>üìù M√¥ t·∫£
                                video:</strong></label>
                        <textarea
                            name="chuongs[__cIndex__].baiGiangs[__bIndex__].videoBaiGiang.mota"
                            class="form-control"
                            placeholder="M√¥ t·∫£ video (t√πy ch·ªçn)"></textarea>
                        <p class="m-2"><i>M√¥ t·∫£ v·ªÅ video c·ªßa b·∫°n.</i></p>
                    </div>

                    <!-- B√ÄI VI·∫æT -->
                    <div class="baiviet-fields mt-2" style="display: none;">

                        <label class="form-label mb-2"><strong>üìÑ N·ªôi dung t√†i
                                li·ªáu:</strong></label>
                        <textarea
                            name="chuongs[__cIndex__].baiGiangs[__bIndex__].baiViet.noidung"
                            class="form-control"
                            placeholder="N·ªôi dung b√†i vi·∫øt"
                            disabled></textarea>
                        <p class="m-2"><i>ƒêi·ªÅn chi ti·∫øt
                                n·ªôi dung
                                gi·∫£ng d·∫°y ho·∫∑c ph·∫ßn b√†i t·∫≠p k√®m theo.</i></p>
                    </div>

                    <!-- TR·∫ÆC NGHI·ªÜM -->
                    <div class="tracnghiem-fields mt-2" style="display: none;">

                        <input type="hidden"
                            name="chuongs[__cIndex__].baiGiangs[__bIndex__].tracNghiem.tracnghiemId"
                            value />

                        <!-- N√∫t chuy·ªÉn trang ƒë·ªÉ th√™m/s·ª≠a c√¢u h·ªèi -->
                        <a href="#" class="btn btn-outline-primary btn-sm mt-2"
                            onclick="return false;">
                            ‚ûï Th√™m ho·∫∑c s·ª≠a c√¢u h·ªèi
                        </a>
                    </div>
                </div>
            </template>
            <script th:src="@{/js/themkhoahoc.js}"></script>
            <style>
            p i {
                font-size: 13px;
            }
            
            .tieude {
                width: 355px;
                padding: 5px;
                border: 1px solid #ccc;
                border-left: 5px solid #0c498a;
                background: #f9f9f9;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 600;
                color: #0c498a;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
                margin-bottom: 20px;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }
        </style>
        </main>
    </body>

</html>