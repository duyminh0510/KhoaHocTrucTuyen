<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi"
  th:replace="~{/views/gdienChung/templateChung.html::view(~{::main}, ~{::title})}">

  <head>
    <meta charset="UTF-8">
    <title>Quản lý nhân viên</title>
    <link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
  </head>

  <body>
    <div class="container mt-4">
      <h2>Quản lý nhân viên</h2>

      <form
        th:action="@{${nhanvien.taikhoanId != null} ? '/admin/qlynhanvien/edit' : '/admin/qlynhanvien/add'}"
        th:object="${nhanvien}" method="post" enctype="multipart/form-data"
        class="mb-4">

        <input type="hidden" th:if="${nhanvien.taikhoanId}"
          th:field="*{taikhoanId}" />

        <div class="mb-3">
          <label class="form-label">Họ tên</label>
          <input type="text" class="form-control" th:field="*{name}" required>
        </div>

        <div class="mb-3">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" th:field="*{email}" required>
        </div>

        <div class="mb-3">
          <label class="form-label">Số điện thoại</label>
          <input type="text" class="form-control" th:field="*{phone}" required>
        </div>

        <!-- Hiện trường mật khẩu khi THÊM MỚI -->
        <div class="mb-3" th:if="${nhanvien.taikhoanId == null}">
          <label class="form-label">Mật khẩu</label>
          <input type="password" class="form-control" th:field="*{password}"
            required>
        </div>

        <!-- Ẩn và giữ giá trị mật khẩu khi CHỈNH SỬA -->
        <input type="hidden" th:if="${nhanvien.taikhoanId != null}"
          th:field="*{password}" />

        <div class="mb-3">
          <label class="form-label">Ảnh đại diện</label>
          <input type="file" class="form-control" name="avatarFile"
            accept="image/*">
          <div th:if="${nhanvien.avatar != null and nhanvien.avatar != ''}"
            class="mt-2">
            <img th:src="@{${nhanvien.avatar}}" alt="avatar"
              class="img-thumbnail" style="height: 100px;">
          </div>
        </div>

        <button type="submit" class="btn btn-primary"
          th:text="${nhanvien.taikhoanId != null ? 'Cập nhật' : 'Thêm'}">Thêm</button>
      </form>

      <table class="table table-bordered">
        <thead>
          <tr>
            <th>STT</th>
            <th>Ảnh</th>
            <th>Họ tên</th>
            <th>Email</th>
            <th>Số điện thoại</th>
            <th>Ngày tạo</th>
            <th>Hành động</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="nv, stat : ${nhanviens}">
            <td th:text="${stat.index + 1}"></td>
            <td>
              <img
                th:src="@{${(nv.avatar != null and nv.avatar != '') ? nv.avatar : '/uploads/default.jpg'}}"
                alt="avatar" width="50" height="50" />
            </td>
            <td th:text="${nv.name}"></td>
            <td th:text="${nv.email}"></td>
            <td th:text="${nv.phone}"></td>
            <td
              th:text="${#temporals.format(nv.ngayTao, 'yyyy-MM-dd HH:mm')}"></td>
            <td>
              <a th:href="@{'/admin/qlynhanvien/edit/' + ${nv.taikhoanId}}"
                class="btn btn-warning btn-sm">Sửa</a>
              <form
                th:action="@{'/admin/qlynhanvien/delete/' + ${nv.taikhoanId}}"
                method="post" style="display:inline;">
                <button type="submit" class="btn btn-danger btn-sm"
                  onclick="return confirm('Bạn có chắc muốn xóa?')">Xóa</button>
              </form>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </body>

</html>