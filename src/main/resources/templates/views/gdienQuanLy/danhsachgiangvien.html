<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi"
    th:replace="~{/views/gdienChung/templateChung.html::view(~{::main}, ~{::title})}">

    <head>
        <title>Danh sách giảng viên</title>
        <meta charset="UTF-8" />
    </head>

    <body>
        <main class="danhsachgiangvien">
            <div class="table-wrapper">
                <h2><i class="fas fa-chalkboard-teacher"></i> Danh sách giảng
                    viên
                </h2>

                <div th:if="${success}" class="alert alert-success"
                    th:text="${success}"></div>
                <div th:if="${error}" class="alert alert-danger"
                    th:text="${error}"></div>

                <div class="table-responsive">
                    <table
                        class="table table-bordered align-middle text-center">
                        <thead>
                            <tr>
                                <th><i class="fas fa-user me-1"></i> Họ tên</th>
                                <th><i class="fas fa-envelope me-1"></i> Email
                                </th>
                                <th><i class="fas fa-phone me-1"></i> SĐT</th>
                                <th><i class="fas fa-briefcase me-1"></i> Công
                                    việc
                                </th>
                                <th><i class="fas fa-calendar-alt me-1"></i>
                                    Ngày đăng ký</th>
                                <th><i class="fas fa-toggle-on me-1"></i> Trạng
                                    thái
                                </th>
                                <th><i class="fas fa-cogs me-1"></i> Hành động
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="tk : ${giangVienList}">
                                <td th:text="${tk.name}">Tên</td>
                                <td
                                    th:text="${@textUtils.maskEmail(tk.email)}">Email</td>
                                <td
                                    th:text="${@textUtils.maskPhone(tk.phone)}">SĐT</td>
                                <td th:text="${tk.giangVien.congViec}">Công việc
                                </td>
                                <td
                                    th:text="${#temporals.format(tk.giangVien.ngayThamGia, 'dd/MM/yyyy HH:mm')}">Ngày</td>
                                <td>
                                    <span
                                        th:text="${tk.status ? 'Hoạt động' : 'Đã khóa'}"
                                        th:classappend="${tk.status} ? 'text-success fw-bold' : 'text-danger fw-bold'">
                                    </span>
                                </td>
                                <td>
                                    <div
                                        class="d-flex gap-2 justify-content-center">
                                        <button type="button" class="btn btn-sm"
                                            th:classappend="${tk.status} ? 'btn-outline-danger' : 'btn-outline-success'"
                                            th:data-id="${tk.taikhoanId}"
                                            th:data-name="${tk.name}"
                                            th:data-status="${tk.status}"
                                            onclick="openConfirmModal(this)"
                                            th:utext="${tk.status} ? '&#128274; Khóa' : '&#128275; Mở'">
                                        </button>

                                        <button type="button"
                                            class="btn btn-outline-primary btn-sm"
                                            th:data-id="${tk.taikhoanId}"
                                            th:data-name="${tk.name}"
                                            th:data-email="${tk.email}"
                                            th:data-phone="${tk.phone}"
                                            th:data-congviec="${tk.giangVien.congViec}"
                                            th:data-cccd="${tk.giangVien.CCCD}"
                                            th:data-ngaysinh="${tk.giangVien.ngaySinh}"
                                            th:data-gioitinh="${tk.giangVien.gioiTinh}"
                                            th:data-chuyennganh="${tk.giangVien.chuyenNganh}"
                                            th:data-kynang="${tk.giangVien.kyNang}"
                                            th:data-kinhnghiem="${tk.giangVien.kinhNghiem}"
                                            onclick="openDetailModal(this)">
                                            <i class="fas fa-info-circle"></i>
                                            Chi tiết
                                        </button>

                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${giangVienList.size() == 0}">
                                <td colspan="7" class="text-muted">Không có
                                    giảng viên nào.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Modal xác nhận -->
            <div class="modal fade" id="confirmModal" tabindex="-1"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content border-0 shadow">
                        <div class="modal-header text-black">
                            <h5 class="modal-title"><i
                                    class="fas fa-exclamation-triangle me-2"></i>
                                Xác nhận thay đổi trạng thái</h5>
                            <button type="button"
                                class="btn-close btn-close-white"
                                data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body text-center">
                            <p class="mb-0">Bạn có chắc chắn muốn <strong
                                    id="modalActionText"></strong> tài khoản
                                <strong id="modalUserName"></strong>?</p>
                        </div>
                        <div class="modal-footer justify-content-end">
                            <form id="confirmForm" method="post" class="mb-0">
                                <button type="submit"
                                    class="btn btn-outline-danger px-4 me-2">
                                    <i class="fas fa-check-circle me-1"></i> Xác
                                    nhận
                                </button>
                            </form>
                            <button type="button"
                                class="btn btn-outline-secondary px-4"
                                data-bs-dismiss="modal">
                                <i class="fas fa-times-circle me-1"></i> Hủy
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="detailModal" tabindex="-1"
                aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content modal-content-custom shadow">
                        <div class="modal-header modal-header-custom">
                            <h5 class="modal-title mb-0"
                                style="font-style: italic;">
                                <i
                                    class="fas fa-chalkboard-teacher me-2 text-primary"></i>
                                Thông tin giảng viên
                            </h5>
                        </div>
                        <div class="modal-body p-4">
                            <div class="row g-3">
                                <div class="col-md-6 info-item">
                                    <i
                                        class="fas fa-user-circle me-2 text-info"></i>
                                    <strong>Họ tên:</strong> <span
                                        id="detailName"></span>
                                </div>
                                <div class="col-md-6 info-item">
                                    <i
                                        class="fas fa-id-card me-2 text-primary"></i>
                                    <strong>CCCD:</strong> <span
                                        id="detailCCCD"></span>
                                </div>
                                <div class="col-md-6 info-item">
                                    <i
                                        class="fas fa-envelope me-2 text-warning"></i>
                                    <strong>Email:</strong> <span
                                        id="detailEmail"></span>
                                </div>
                                <div class="col-md-6 info-item">
                                    <i
                                        class="fas fa-phone me-2 text-success"></i>
                                    <strong>SĐT:</strong> <span
                                        id="detailPhone"></span>
                                </div>
                                <div class="col-md-6 info-item">
                                    <i
                                        class="fas fa-calendar-day me-2 text-danger"></i>
                                    <strong>Ngày sinh:</strong> <span
                                        id="detailNgaySinh"></span>
                                </div>
                                <div class="col-md-6 info-item">
                                    <i
                                        class="fas fa-venus-mars me-2 text-secondary"></i>
                                    <strong>Giới tính:</strong> <span
                                        id="detailGioiTinh"></span>
                                </div>
                                <div class="col-md-6 info-item">
                                    <i
                                        class="fas fa-briefcase me-2 text-info"></i>
                                    <strong>Công việc:</strong> <span
                                        id="detailCongViec"></span>
                                </div>
                                <div class="col-md-6 info-item">
                                    <i
                                        class="fas fa-cogs me-2 text-success"></i>
                                    <strong>Kỹ năng:</strong> <span
                                        id="detailKyNang"></span>
                                </div>
                                <div class="col-md-6 info-item">
                                    <i
                                        class="fas fa-clock me-2 text-danger"></i>
                                    <strong>Kinh nghiệm:</strong> <span
                                        id="detailKinhNghiem"></span>
                                </div>
                                <div class="col-md-6 info-item">
                                    <i
                                        class="fas fa-graduation-cap me-2 text-warning"></i>
                                    <strong>Chuyên ngành:</strong> <span
                                        id="detailChuyenNganh"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
            function maskEmail(email) {
                if (!email || !email.includes("@")) return "*******";
                const [name, domain] = email.split("@");
                return name.substring(0, 2) + "****@" + domain;
            }

            function maskPhone(phone) {
                if (!phone || phone.length < 4) return "******";
                return "*******" + phone.slice(-3);
            }

            function maskCCCD(cccd) {
                if (!cccd || cccd.length < 4) return "********";
                return "*".repeat(cccd.length - 3) + cccd.slice(-3);
            }

            function openDetailModal(button) {
                document.getElementById("detailName").textContent = button.getAttribute("data-name") || "";
                document.getElementById("detailEmail").textContent = maskEmail(button.getAttribute("data-email"));
                document.getElementById("detailPhone").textContent = maskPhone(button.getAttribute("data-phone"));
                document.getElementById("detailCCCD").textContent = maskCCCD(button.getAttribute("data-cccd"));
                document.getElementById("detailNgaySinh").textContent = button.getAttribute("data-ngaysinh") || "";
                document.getElementById("detailGioiTinh").textContent = button.getAttribute("data-gioitinh") || "";
                document.getElementById("detailCongViec").textContent = button.getAttribute("data-congviec") || "";
                document.getElementById("detailChuyenNganh").textContent = button.getAttribute("data-chuyennganh") || "";
                document.getElementById("detailKyNang").textContent = button.getAttribute("data-kynang") || "";
                document.getElementById("detailKinhNghiem").textContent = button.getAttribute("data-kinhnghiem") || "";

                const modal = new bootstrap.Modal(document.getElementById("detailModal"));
                modal.show();
            }
        </script>

            <script>
            function openConfirmModal(button) {
                const id = button.getAttribute("data-id");
                const name = button.getAttribute("data-name");
                const status = button.getAttribute("data-status") === "true";

                // Hiển thị hành động tương ứng
                const action = status ? "khóa" : "mở khóa";
                document.getElementById("modalActionText").textContent = action;
                document.getElementById("modalUserName").textContent = name;

                // Cập nhật form action
                const prefix = window.location.pathname.split('/')[1]; // lấy /admin hoặc /nhanvien
                document.getElementById("confirmForm").action = `/${prefix}/quanly-giangvien/toggle-status/${id}`;

                // Hiển thị modal
                const modal = new bootstrap.Modal(document.getElementById("confirmModal"));
                modal.show();
            }
        </script>

        </main>
    </body>

</html>